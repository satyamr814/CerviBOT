<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cervical Health Risk Assessment Chatbot</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Noto Sans Devanagari', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    .container {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      width: 100%;
      max-width: 800px;
      height: 90vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
      text-align: center;
      position: relative;
    }

    .lang-toggle {
      position: absolute;
      top: 20px;
      right: 20px;
      background: rgba(255, 255, 255, 0.2);
      border: 2px solid white;
      color: white;
      padding: 8px 16px;
      border-radius: 20px;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      transition: all 0.3s;
    }

    .lang-toggle:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: scale(1.05);
    }

    .header h1 {
      font-size: 24px;
      margin-bottom: 5px;
    }

    .header p {
      opacity: 0.9;
      font-size: 14px;
    }

    .chat-container {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
      background: #f8f9fa;
    }

    .message {
      margin-bottom: 15px;
      animation: fadeIn 0.3s ease-in;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .bot-message {
      display: flex;
      align-items: flex-start;
    }

    .bot-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      margin-right: 10px;
      flex-shrink: 0;
    }

    .bot-text {
      background: white;
      padding: 12px 16px;
      border-radius: 18px;
      max-width: 70%;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      line-height: 1.5;
    }

    .user-message {
      display: flex;
      justify-content: flex-end;
      align-items: flex-start;
    }

    .user-text {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 12px 16px;
      border-radius: 18px;
      max-width: 70%;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    .result-box {
      background: white;
      border-radius: 12px;
      padding: 20px;
      margin-top: 15px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }

    .risk-badge {
      display: inline-block;
      padding: 8px 16px;
      border-radius: 20px;
      font-weight: bold;
      font-size: 14px;
      margin: 10px 0;
    }

    .risk-low { background: #10b981; color: white; }
    .risk-medium { background: #f59e0b; color: white; }
    .risk-high { background: #ef4444; color: white; }

    .probability-gauge {
      width: 100%;
      height: 30px;
      background: #e5e7eb;
      border-radius: 15px;
      overflow: hidden;
      margin: 15px 0;
      position: relative;
    }

    .probability-fill {
      height: 100%;
      transition: width 0.5s ease;
      border-radius: 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      font-size: 12px;
    }

    .question-area {
      padding: 20px;
      background: white;
      border-top: 1px solid #e5e7eb;
    }

    .options-container {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 15px;
    }

    .option-btn {
      padding: 12px 20px;
      border: 2px solid #667eea;
      background: white;
      color: #667eea;
      border-radius: 25px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.3s ease;
      font-weight: 500;
    }

    .option-btn:hover {
      background: #667eea;
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }

    .input-group {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }

    .number-input {
      flex: 1;
      padding: 12px 16px;
      border: 2px solid #e5e7eb;
      border-radius: 25px;
      font-size: 14px;
      outline: none;
      transition: border-color 0.3s;
    }

    .number-input:focus {
      border-color: #667eea;
    }

    .submit-btn {
      padding: 12px 24px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 25px;
      cursor: pointer;
      font-weight: 600;
      transition: transform 0.2s;
    }

    .submit-btn:hover {
      transform: scale(1.05);
    }

    .submit-btn:active {
      transform: scale(0.95);
    }

    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .explain-btn {
      margin-top: 15px;
      padding: 10px 20px;
      background: #6b7280;
      color: white;
      border: none;
      border-radius: 20px;
      cursor: pointer;
      font-size: 13px;
      transition: background 0.3s;
    }

    .explain-btn:hover {
      background: #4b5563;
    }

    .progress-indicator {
      text-align: center;
      color: #6b7280;
      font-size: 12px;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <button class="lang-toggle" id="langToggle">‡§π‡§ø‡§Ç‡§¶‡•Ä</button>
      <h1 id="headerTitle">üè• Cervical Health Risk Assessment</h1>
      <p id="headerSubtitle">Answer a few questions to assess your risk level</p>
    </div>

    <div class="chat-container" id="conversation"></div>

    <div class="question-area" id="question-area"></div>
  </div>

  <script>
    // Translations
    const translations = {
      en: {
        title: 'üè• Cervical Health Risk Assessment',
        subtitle: 'Answer a few questions to assess your risk level',
        langButton: '‡§π‡§ø‡§Ç‡§¶‡•Ä',
        hello: "Hello! I'm here to help assess your cervical health risk. Let's start with a few questions.",
        analyzing: "Thanks for your answers! Analyzing your risk...",
        riskResult: 'Risk Assessment Result',
        probability: 'Probability',
        label: 'Label',
        confidence: 'Confidence',
        whyPrediction: 'Why this prediction?',
        next: 'Next',
        questionOf: (c, t) => `Question ${c} of ${t}`,
        questions: [
          { key: 'Age', text: 'What is your age?' },
          { key: 'Num_of_sexual_partners', text: 'How many sexual partners have you had?' },
          { key: 'First_sex_age', text: 'At what age did you first have sexual intercourse?' },
          { key: 'Num_of_pregnancies', text: 'How many pregnancies have you had?' },
          { key: 'Smokes_years', text: 'How many years have you been smoking? (Enter 0 if you don\'t smoke)' },
          { key: 'Hormonal_contraceptives', text: 'Are you currently using hormonal contraceptives?', options: ['Yes', 'No'] },
          { key: 'Hormonal_contraceptives_years', text: 'If yes, for how many years? (Enter 0 if not applicable)', conditional: 'Hormonal_contraceptives', conditionalValue: 'Yes' },
          { key: 'STDs_HIV', text: 'What is your HIV status?', options: ['No', 'Yes'] },
          { key: 'Pain_during_intercourse', text: 'Do you experience pain during intercourse?', options: ['Yes', 'No'] },
          { key: 'Vaginal_discharge_type', text: 'What type of vaginal discharge do you experience?', options: ['None', 'watery', 'thick', 'bloody'] },
          { key: 'Vaginal_discharge_color', text: 'What color is your vaginal discharge?', options: ['normal', 'pink', 'pale', 'bloody'] },
          { key: 'Vaginal_bleeding_timing', text: 'When do you experience abnormal vaginal bleeding?', options: ['None', 'Between periods', 'After sex', 'After menopause'] }
        ],
        riskLow: 'Low Risk',
        riskMedium: 'Medium Risk',
        riskHigh: 'High Risk',
        adviceLow: 'Low risk ‚Äî routine screening as per local guidelines is recommended.',
        adviceMedium: 'Medium risk ‚Äî consider scheduling a clinical check-up and follow-up screening.',
        adviceHigh: 'High risk ‚Äî seek urgent clinical evaluation and further diagnostic testing.',
        enterNumber: 'Enter a number'
      },
      hi: {
        title: 'üè• ‡§ó‡§∞‡•ç‡§≠‡§æ‡§∂‡§Ø ‡§ó‡•ç‡§∞‡•Ä‡§µ‡§æ ‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø ‡§ú‡•ã‡§ñ‡§ø‡§Æ ‡§Æ‡•Ç‡§≤‡•ç‡§Ø‡§æ‡§Ç‡§ï‡§®',
        subtitle: '‡§Ö‡§™‡§®‡•á ‡§ú‡•ã‡§ñ‡§ø‡§Æ ‡§∏‡•ç‡§§‡§∞ ‡§ï‡§æ ‡§Ü‡§ï‡§≤‡§® ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡•Å‡§õ ‡§™‡•ç‡§∞‡§∂‡•ç‡§®‡•ã‡§Ç ‡§ï‡•á ‡§â‡§§‡•ç‡§§‡§∞ ‡§¶‡•á‡§Ç',
        langButton: 'English',
        hello: '‡§®‡§Æ‡§∏‡•ç‡§§‡•á! ‡§Æ‡•à‡§Ç ‡§Ü‡§™‡§ï‡•á ‡§ó‡§∞‡•ç‡§≠‡§æ‡§∂‡§Ø ‡§ó‡•ç‡§∞‡•Ä‡§µ‡§æ ‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø ‡§ú‡•ã‡§ñ‡§ø‡§Æ ‡§ï‡§æ ‡§Ü‡§ï‡§≤‡§® ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§Æ‡§¶‡§¶ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ø‡§π‡§æ‡§Ç ‡§π‡•Ç‡§Ç‡•§ ‡§Ü‡§á‡§è ‡§ï‡•Å‡§õ ‡§™‡•ç‡§∞‡§∂‡•ç‡§®‡•ã‡§Ç ‡§∏‡•á ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç‡•§',
        analyzing: '‡§Ü‡§™‡§ï‡•á ‡§â‡§§‡•ç‡§§‡§∞‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶! ‡§Ü‡§™‡§ï‡•á ‡§ú‡•ã‡§ñ‡§ø‡§Æ ‡§ï‡§æ ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∞‡§π‡§æ ‡§π‡•à...',
        riskResult: '‡§ú‡•ã‡§ñ‡§ø‡§Æ ‡§Æ‡•Ç‡§≤‡•ç‡§Ø‡§æ‡§Ç‡§ï‡§® ‡§™‡§∞‡§ø‡§£‡§æ‡§Æ',
        probability: '‡§∏‡§Ç‡§≠‡§æ‡§µ‡§®‡§æ',
        label: '‡§≤‡•á‡§¨‡§≤',
        confidence: '‡§Ü‡§§‡•ç‡§Æ‡§µ‡§ø‡§∂‡•ç‡§µ‡§æ‡§∏',
        whyPrediction: '‡§Ø‡§π ‡§≠‡§µ‡§ø‡§∑‡•ç‡§Ø‡§µ‡§æ‡§£‡•Ä ‡§ï‡•ç‡§Ø‡•ã‡§Ç?',
        next: '‡§Ö‡§ó‡§≤‡§æ',
        questionOf: (c, t) => `‡§™‡•ç‡§∞‡§∂‡•ç‡§® ${c} ‡§Æ‡•á‡§Ç ‡§∏‡•á ${t}`,
        questions: [
          { key: 'Age', text: '‡§Ü‡§™‡§ï‡•Ä ‡§â‡§Æ‡•ç‡§∞ ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•à?' },
          { key: 'Num_of_sexual_partners', text: '‡§Ü‡§™‡§ï‡•á ‡§ï‡§ø‡§§‡§®‡•á ‡§Ø‡•å‡§® ‡§∏‡§æ‡§•‡•Ä ‡§∞‡§π‡•á ‡§π‡•à‡§Ç?' },
          { key: 'First_sex_age', text: '‡§Ü‡§™‡§®‡•á ‡§™‡§π‡§≤‡•Ä ‡§¨‡§æ‡§∞ ‡§ï‡§ø‡§∏ ‡§â‡§Æ‡•ç‡§∞ ‡§Æ‡•á‡§Ç ‡§Ø‡•å‡§® ‡§∏‡§Ç‡§¨‡§Ç‡§ß ‡§¨‡§®‡§æ‡§è?' },
          { key: 'Num_of_pregnancies', text: '‡§Ü‡§™‡§ï‡•Ä ‡§ï‡§ø‡§§‡§®‡•Ä ‡§ó‡§∞‡•ç‡§≠‡§æ‡§µ‡§∏‡•ç‡§•‡§æ‡§è‡§Ç ‡§∞‡§π‡•Ä ‡§π‡•à‡§Ç?' },
          { key: 'Smokes_years', text: '‡§Ü‡§™ ‡§ï‡§ø‡§§‡§®‡•á ‡§µ‡§∞‡•ç‡§∑‡•ã‡§Ç ‡§∏‡•á ‡§ß‡•Ç‡§Æ‡•ç‡§∞‡§™‡§æ‡§® ‡§ï‡§∞ ‡§∞‡§π‡•á ‡§π‡•à‡§Ç? (‡§Ø‡§¶‡§ø ‡§Ü‡§™ ‡§ß‡•Ç‡§Æ‡•ç‡§∞‡§™‡§æ‡§® ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç ‡§§‡•ã 0 ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç)' },
          { key: 'Hormonal_contraceptives', text: '‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® ‡§Æ‡•á‡§Ç ‡§π‡§æ‡§∞‡•ç‡§Æ‡•ã‡§®‡§≤ ‡§ó‡§∞‡•ç‡§≠‡§®‡§ø‡§∞‡•ã‡§ß‡§ï ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞ ‡§∞‡§π‡•á ‡§π‡•à‡§Ç?', options: ['‡§π‡§æ‡§Å', '‡§®‡§π‡•Ä‡§Ç'] },
          { key: 'Hormonal_contraceptives_years', text: '‡§Ø‡§¶‡§ø ‡§π‡§æ‡§Å, ‡§§‡•ã ‡§ï‡§ø‡§§‡§®‡•á ‡§µ‡§∞‡•ç‡§∑‡•ã‡§Ç ‡§∏‡•á? (‡§Ø‡§¶‡§ø ‡§≤‡§æ‡§ó‡•Ç ‡§®‡§π‡•Ä‡§Ç ‡§π‡•ã‡§§‡§æ ‡§§‡•ã 0 ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç)', conditional: 'Hormonal_contraceptives', conditionalValue: '‡§π‡§æ‡§Å' },
          { key: 'STDs_HIV', text: '‡§Ü‡§™‡§ï‡•Ä HIV ‡§∏‡•ç‡§•‡§ø‡§§‡§ø ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•à?', options: ['‡§®‡§π‡•Ä‡§Ç', '‡§π‡§æ‡§Å'] },
          { key: 'Pain_during_intercourse', text: '‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™‡§ï‡•ã ‡§∏‡§Ç‡§≠‡•ã‡§ó ‡§ï‡•á ‡§¶‡•å‡§∞‡§æ‡§® ‡§¶‡§∞‡•ç‡§¶ ‡§π‡•ã‡§§‡§æ ‡§π‡•à?', options: ['‡§π‡§æ‡§Å', '‡§®‡§π‡•Ä‡§Ç'] },
          { key: 'Vaginal_discharge_type', text: '‡§Ü‡§™‡§ï‡•ã ‡§ï‡§ø‡§∏ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞ ‡§ï‡§æ ‡§Ø‡•ã‡§®‡§ø ‡§∏‡•ç‡§∞‡§æ‡§µ ‡§π‡•ã‡§§‡§æ ‡§π‡•à?', options: ['‡§ï‡•ã‡§à ‡§®‡§π‡•Ä‡§Ç', '‡§™‡§æ‡§®‡•Ä ‡§ú‡•à‡§∏‡§æ', '‡§ó‡§æ‡§¢‡§º‡§æ', '‡§ñ‡•Ç‡§®‡•Ä'] },
          { key: 'Vaginal_discharge_color', text: '‡§Ü‡§™‡§ï‡•á ‡§Ø‡•ã‡§®‡§ø ‡§∏‡•ç‡§∞‡§æ‡§µ ‡§ï‡§æ ‡§∞‡§Ç‡§ó ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•à?', options: ['‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø', '‡§ó‡•Å‡§≤‡§æ‡§¨‡•Ä', '‡§™‡•Ä‡§≤‡§æ', '‡§ñ‡•Ç‡§®‡•Ä'] },
          { key: 'Vaginal_bleeding_timing', text: '‡§Ü‡§™‡§ï‡•ã ‡§Ö‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§Ø‡•ã‡§®‡§ø ‡§∞‡§ï‡•ç‡§§‡§∏‡•ç‡§∞‡§æ‡§µ ‡§ï‡§¨ ‡§π‡•ã‡§§‡§æ ‡§π‡•à?', options: ['‡§ï‡•ã‡§à ‡§®‡§π‡•Ä‡§Ç', '‡§Æ‡§æ‡§∏‡§ø‡§ï ‡§ß‡§∞‡•ç‡§Æ ‡§ï‡•á ‡§¨‡•Ä‡§ö', '‡§∏‡§Ç‡§≠‡•ã‡§ó ‡§ï‡•á ‡§¨‡§æ‡§¶', '‡§∞‡§ú‡•ã‡§®‡§ø‡§µ‡•É‡§§‡•ç‡§§‡§ø ‡§ï‡•á ‡§¨‡§æ‡§¶'] }
        ],
        riskLow: '‡§ï‡§Æ ‡§ú‡•ã‡§ñ‡§ø‡§Æ',
        riskMedium: '‡§Æ‡§ß‡•ç‡§Ø‡§Æ ‡§ú‡•ã‡§ñ‡§ø‡§Æ',
        riskHigh: '‡§â‡§ö‡•ç‡§ö ‡§ú‡•ã‡§ñ‡§ø‡§Æ',
        adviceLow: '‡§ï‡§Æ ‡§ú‡•ã‡§ñ‡§ø‡§Æ ‚Äî ‡§∏‡•ç‡§•‡§æ‡§®‡•Ä‡§Ø ‡§¶‡§ø‡§∂‡§æ‡§®‡§ø‡§∞‡•ç‡§¶‡•á‡§∂‡•ã‡§Ç ‡§ï‡•á ‡§Ö‡§®‡•Å‡§∏‡§æ‡§∞ ‡§®‡§ø‡§Ø‡§Æ‡§ø‡§§ ‡§ú‡§æ‡§Ç‡§ö ‡§ï‡•Ä ‡§∏‡§ø‡§´‡§æ‡§∞‡§ø‡§∂ ‡§ï‡•Ä ‡§ú‡§æ‡§§‡•Ä ‡§π‡•à‡•§',
        adviceMedium: '‡§Æ‡§ß‡•ç‡§Ø‡§Æ ‡§ú‡•ã‡§ñ‡§ø‡§Æ ‚Äî ‡§®‡•à‡§¶‡§æ‡§®‡§ø‡§ï ‡§ú‡§æ‡§Ç‡§ö ‡§î‡§∞ ‡§Ö‡§®‡•Å‡§µ‡§∞‡•ç‡§§‡•Ä ‡§ú‡§æ‡§Ç‡§ö ‡§∂‡•á‡§°‡•ç‡§Ø‡•Ç‡§≤ ‡§ï‡§∞‡§®‡•á ‡§™‡§∞ ‡§µ‡§ø‡§ö‡§æ‡§∞ ‡§ï‡§∞‡•á‡§Ç‡•§',
        adviceHigh: '‡§â‡§ö‡•ç‡§ö ‡§ú‡•ã‡§ñ‡§ø‡§Æ ‚Äî ‡§§‡§§‡•ç‡§ï‡§æ‡§≤ ‡§®‡•à‡§¶‡§æ‡§®‡§ø‡§ï ‡§Æ‡•Ç‡§≤‡•ç‡§Ø‡§æ‡§Ç‡§ï‡§® ‡§î‡§∞ ‡§Ü‡§ó‡•á ‡§ï‡•Ä ‡§®‡•à‡§¶‡§æ‡§®‡§ø‡§ï ‡§ú‡§æ‡§Ç‡§ö ‡§ï‡§∞‡§æ‡§è‡§Ç‡•§',
        enterNumber: '‡§è‡§ï ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç'
      }
    };

    // Option value mappings (Hindi to English)
    const optionMapping = {
      hi: {
        '‡§π‡§æ‡§Å': 'Yes',
        '‡§®‡§π‡•Ä‡§Ç': 'No',
        '‡§ï‡•ã‡§à ‡§®‡§π‡•Ä‡§Ç': 'None',
        '‡§™‡§æ‡§®‡•Ä ‡§ú‡•à‡§∏‡§æ': 'watery',
        '‡§ó‡§æ‡§¢‡§º‡§æ': 'thick',
        '‡§ñ‡•Ç‡§®‡•Ä': 'bloody',
        '‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø': 'normal',
        '‡§ó‡•Å‡§≤‡§æ‡§¨‡•Ä': 'pink',
        '‡§™‡•Ä‡§≤‡§æ': 'pale',
        '‡§Æ‡§æ‡§∏‡§ø‡§ï ‡§ß‡§∞‡•ç‡§Æ ‡§ï‡•á ‡§¨‡•Ä‡§ö': 'Between periods',
        '‡§∏‡§Ç‡§≠‡•ã‡§ó ‡§ï‡•á ‡§¨‡§æ‡§¶': 'After sex',
        '‡§∞‡§ú‡•ã‡§®‡§ø‡§µ‡•É‡§§‡•ç‡§§‡§ø ‡§ï‡•á ‡§¨‡§æ‡§¶': 'After menopause'
      },
      en: {}
    };

    let currentLang = 'en';
    const state = {
      Age: null,
      Num_of_sexual_partners: null,
      First_sex_age: null,
      Num_of_pregnancies: null,
      Smokes_years: 0,
      Hormonal_contraceptives: 'No',
      Hormonal_contraceptives_years: 0,
      STDs_HIV: 'No',
      Pain_during_intercourse: 'No',
      Vaginal_discharge_type: 'None',
      Vaginal_discharge_color: 'normal',
      Vaginal_bleeding_timing: 'None'
    };

    const conversation = document.getElementById('conversation');
    const qArea = document.getElementById('question-area');
    const langToggle = document.getElementById('langToggle');
    const headerTitle = document.getElementById('headerTitle');
    const headerSubtitle = document.getElementById('headerSubtitle');

    function t(key, ...args) {
      const trans = translations[currentLang][key];
      return typeof trans === 'function' ? trans(...args) : trans;
    }

    function switchLanguage() {
      currentLang = currentLang === 'en' ? 'hi' : 'en';
      langToggle.textContent = currentLang === 'en' ? '‡§π‡§ø‡§Ç‡§¶‡•Ä' : 'English';
      headerTitle.textContent = t('title');
      headerSubtitle.textContent = t('subtitle');
      
      // Clear and restart conversation
      conversation.innerHTML = '';
      qArea.innerHTML = '';
      stepIndex = 0;
      bot(t('hello'));
      askNext();
    }

    langToggle.addEventListener('click', switchLanguage);

    function bot(msg, isResult = false) {
      const messageDiv = document.createElement('div');
      messageDiv.className = 'message bot-message';
      
      const avatar = document.createElement('div');
      avatar.className = 'bot-avatar';
      avatar.textContent = 'ü§ñ';
      
      const text = document.createElement('div');
      text.className = 'bot-text';
      text.innerHTML = msg;
      
      messageDiv.appendChild(avatar);
      messageDiv.appendChild(text);
      conversation.appendChild(messageDiv);
      
      if (isResult) {
        const resultBox = document.createElement('div');
        resultBox.className = 'result-box';
        resultBox.innerHTML = msg;
        text.innerHTML = '';
        text.appendChild(resultBox);
      }
      
      conversation.scrollTop = conversation.scrollHeight;
    }

    function user(msg) {
      const messageDiv = document.createElement('div');
      messageDiv.className = 'message user-message';
      
      const text = document.createElement('div');
      text.className = 'user-text';
      text.textContent = msg;
      
      messageDiv.appendChild(text);
      conversation.appendChild(messageDiv);
      conversation.scrollTop = conversation.scrollHeight;
    }

    let stepIndex = 0;
    let currentInput = null;

    function askNext() {
      const steps = t('questions');
      if (stepIndex >= steps.length) {
        bot(t('analyzing'));
        qArea.innerHTML = '<div class="loading"></div>';
        sendToBackend();
        return;
      }

      const s = steps[stepIndex];
      
      // Skip conditional questions if condition not met
      if (s.conditional) {
        const conditionValue = s.conditionalValue;
        const stateValue = state[s.conditional];
        // Map Hindi value to English if needed
        const mappedValue = currentLang === 'hi' && optionMapping.hi[stateValue] ? optionMapping.hi[stateValue] : stateValue;
        const mappedCondition = currentLang === 'hi' && optionMapping.hi[conditionValue] ? optionMapping.hi[conditionValue] : conditionValue;
        if (mappedValue !== mappedCondition) {
          stepIndex++;
          askNext();
          return;
        }
      }

      qArea.innerHTML = '';
      
      const questionContainer = document.createElement('div');
      questionContainer.style.marginBottom = '15px';
      
      const questionText = document.createElement('div');
      questionText.className = 'bot-text';
      questionText.textContent = s.text;
      questionText.style.marginBottom = '15px';
      questionContainer.appendChild(questionText);
      
      const progressDiv = document.createElement('div');
      progressDiv.className = 'progress-indicator';
      progressDiv.textContent = t('questionOf', stepIndex + 1, steps.length);
      questionContainer.appendChild(progressDiv);
      
      const messageDiv = document.createElement('div');
      messageDiv.className = 'message bot-message';
      const avatar = document.createElement('div');
      avatar.className = 'bot-avatar';
      avatar.textContent = 'ü§ñ';
      messageDiv.appendChild(avatar);
      messageDiv.appendChild(questionContainer);
      conversation.appendChild(messageDiv);

      if (s.options) {
        const div = document.createElement('div');
        div.className = 'options-container';
        div.style.marginTop = '10px';
        s.options.forEach(opt => {
          const btn = document.createElement('button');
          btn.className = 'option-btn';
          btn.textContent = opt;
          btn.onclick = () => {
            user(opt);
            // Map Hindi option to English value for backend
            const backendValue = currentLang === 'hi' && optionMapping.hi[opt] ? optionMapping.hi[opt] : opt;
            state[s.key] = backendValue;
            stepIndex++;
            askNext();
          };
          div.appendChild(btn);
        });
        qArea.appendChild(div);
      } else {
        const inputGroup = document.createElement('div');
        inputGroup.className = 'input-group';
        inputGroup.style.marginTop = '10px';
        
        const input = document.createElement('input');
        input.type = 'number';
        input.className = 'number-input';
        input.placeholder = t('enterNumber');
        input.id = 'num_input';
        currentInput = input;
        
        const btn = document.createElement('button');
        btn.className = 'submit-btn';
        btn.textContent = t('next');
        btn.onclick = () => {
          const v = input.value;
          const numValue = Number(v || 0);
          user(v || '0');
          state[s.key] = numValue;
          stepIndex++;
          askNext();
        };
        
        input.addEventListener('keypress', (e) => {
          if (e.key === 'Enter') {
            btn.click();
          }
        });
        
        inputGroup.appendChild(input);
        inputGroup.appendChild(btn);
        qArea.appendChild(inputGroup);
        setTimeout(() => input.focus(), 100);
      }
      
      conversation.scrollTop = conversation.scrollHeight;
    }

    async function sendToBackend() {
      try {
        const payload = { ...state };
        const resp = await fetch('/predict', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify(payload)
        });

        const data = await resp.json();
        qArea.innerHTML = '';

        if (resp.ok) {
          const riskClass = data.risk_bucket.toLowerCase();
          const probPercent = data.probability_percent || (data.probability * 100).toFixed(1);
          
          const riskText = riskClass === 'low' ? t('riskLow') : riskClass === 'medium' ? t('riskMedium') : t('riskHigh');
          const adviceText = riskClass === 'low' ? t('adviceLow') : riskClass === 'medium' ? t('adviceMedium') : t('adviceHigh');
          
          const resultHTML = `
            <div style="text-align: center;">
              <h3 style="margin-bottom: 15px;">${t('riskResult')}</h3>
              <div class="risk-badge risk-${riskClass}" style="background: ${data.risk_color || '#6b7280'};">
                ${riskText}
              </div>
              <div style="margin: 20px 0;">
                <div style="font-size: 36px; font-weight: bold; color: ${data.risk_color || '#6b7280'};">
                  ${probPercent}%
                </div>
                <div style="color: #6b7280; font-size: 14px;">${t('probability')}</div>
              </div>
              <div class="probability-gauge">
                <div class="probability-fill" style="width: ${probPercent}%; background: ${data.risk_color || '#6b7280'};">
                  ${probPercent >= 10 ? probPercent + '%' : ''}
                </div>
              </div>
              <p style="margin-top: 20px; line-height: 1.6; color: #374151;">
                ${adviceText}
              </p>
              <p style="margin-top: 10px; font-size: 12px; color: #6b7280;">
                ${t('label')}: ${data.label || 'N/A'} | ${t('confidence')}: ${data.confidence || 'N/A'}
              </p>
              <button class="explain-btn" onclick="explainPrediction()">${t('whyPrediction')}</button>
            </div>
          `;
          
          bot(resultHTML, true);
        } else {
          bot("Error: " + (data.detail || JSON.stringify(data)));
        }
      } catch (err) {
        qArea.innerHTML = '';
        bot(t('errorNetwork', err.message));
      }
    }

    async function explainPrediction() {
      try {
        const payload = { ...state };
        const resp = await fetch('/explain', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify(payload)
        });

        const data = await resp.json();
        if (resp.ok) {
          const explanation = data.explanation || 'Explanation not available';
          bot('<h4>Explanation:</h4><pre style="text-align: left; white-space: pre-wrap; margin-top: 10px;">' + explanation + '</pre>', true);
        } else {
          bot("Explanation unavailable: " + (data.detail || "Error occurred"));
        }
      } catch (err) {
        bot(t('errorExplanation', err.message));
      }
    }

    // Start conversation
    bot(t('hello'));
    askNext();
  </script>
</body>
</html>

